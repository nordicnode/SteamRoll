<UserControl x:Class="SteamRoll.Controls.WindowHeader"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:SteamRoll.Controls"
             mc:Ignorable="d"
             d:DesignHeight="100" d:DesignWidth="800">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Border Background="{DynamicResource BackgroundMediumBrush}">
        <Grid>
            <!-- Gradient accent line at top -->
            <Border Height="3" VerticalAlignment="Top" Background="{DynamicResource HeaderGradient}"/>

            <Grid Margin="32,20,32,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Logo -->
                    <Border Width="48" Height="48" CornerRadius="12" Margin="0,0,16,0">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#58A6FF" Offset="0"/>
                                <GradientStop Color="#A371F7" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Path Fill="White" Data="{StaticResource IconController}" Width="24" Height="24" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="SteamRoll" FontSize="26" FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <TextBlock Text="Share your Steam library across your household" FontSize="13"
                                   Foreground="{DynamicResource TextMutedBrush}" Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- View Toggle -->
                    <Border Background="{DynamicResource BackgroundLightBrush}" CornerRadius="6" Margin="0,0,16,0">
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="LibraryTabBtn"
                                    Style="{DynamicResource SecondaryButton}"
                                    Click="LibraryTab_Click" Padding="12,8">
                                <StackPanel Orientation="Horizontal">
                                    <Path Fill="{DynamicResource TextSecondaryBrush}" Data="{StaticResource IconLibrary}" Width="14" Height="14" Stretch="Uniform" Margin="0,0,6,0"/>
                                    <TextBlock Text="Library"/>
                                </StackPanel>
                            </Button>
                            <Button x:Name="PackagesTabBtn"
                                    Style="{DynamicResource SecondaryButton}"
                                    Click="PackagesTab_Click" Padding="12,8">
                                <StackPanel Orientation="Horizontal">
                                    <Path Fill="{DynamicResource TextSecondaryBrush}" Data="{StaticResource IconPackage}" Width="14" Height="14" Stretch="Uniform" Margin="0,0,6,0"/>
                                    <TextBlock Text="Packages"/>
                                </StackPanel>
                            </Button>
                            <!-- Toggle View Mode -->
                            <ToggleButton x:Name="ViewModeToggle" Click="ViewModeToggle_Click"
                                          Background="Transparent" BorderThickness="0" Padding="12,8" Cursor="Hand">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="0,6,6,0" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#30363D"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#21262D"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="ViewModeIcon" Text="ðŸ“‘" FontFamily="Segoe UI Emoji" Foreground="White"/>
                                </StackPanel>
                                <ToggleButton.ToolTip>
                                    <ToolTip Content="Toggle List View"/>
                                </ToggleButton.ToolTip>
                            </ToggleButton>
                        </StackPanel>
                    </Border>
                    <Button Style="{DynamicResource SecondaryButton}"
                            Click="RefreshButton_Click" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âŸ³" FontFamily="Segoe UI Emoji" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,6,0"/>
                            <TextBlock Text="Refresh"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource SecondaryButton}"
                            Click="OpenOutputButton_Click" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“" FontFamily="Segoe UI Emoji" Margin="0,0,6,0"/>
                            <TextBlock Text="Open Output"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource SecondaryButton}"
                            Click="ImportPackageButton_Click" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¥" FontFamily="Segoe UI Emoji" Margin="0,0,6,0"/>
                            <TextBlock Text="Import Package"/>
                        </StackPanel>
                    </Button>
                    <ToggleButton x:Name="SelectModeToggle"
                                  Click="SelectModeToggle_Click" Margin="0,0,12,0"
                                  Background="Transparent" Foreground="{DynamicResource TextSecondaryBrush}"
                                  BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="1"
                                  Padding="14,8" Cursor="Hand">
                        <ToggleButton.Template>
                            <ControlTemplate TargetType="ToggleButton">
                                <Border x:Name="border" Background="{TemplateBinding Background}"
                                        CornerRadius="6" Padding="{TemplateBinding Padding}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        BorderBrush="{TemplateBinding BorderBrush}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#238636"/>
                                        <Setter TargetName="border" Property="BorderBrush" Value="#238636"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#21262D"/>
                                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ToggleButton.Template>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â˜‘" FontFamily="Segoe UI Emoji" Margin="0,0,6,0"/>
                            <TextBlock Text="Select"/>
                        </StackPanel>
                    </ToggleButton>
                    <Button x:Name="TransfersBtn"
                            Style="{DynamicResource SecondaryButton}"
                            Click="TransfersButton_Click" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¡" FontFamily="Segoe UI Emoji" Margin="0,0,6,0"/>
                            <TextBlock x:Name="TransfersText" Text="Transfers"/>
                            <!-- Active transfer count badge -->
                            <Border x:Name="TransfersBadge" Visibility="Collapsed"
                                    Background="#EF4444" CornerRadius="8" 
                                    MinWidth="18" Height="18" Margin="6,0,0,0"
                                    VerticalAlignment="Center" Padding="5,0">
                                <TextBlock x:Name="TransfersBadgeCount" Text="0"
                                           FontSize="10" FontWeight="Bold" Foreground="White"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource SecondaryButton}"
                            Click="SettingsButton_Click" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš™" FontFamily="Segoe UI Emoji" Margin="0,0,6,0"/>
                            <TextBlock Text="Settings"/>
                        </StackPanel>
                    </Button>

                    <!-- Search Box -->
                    <TextBox x:Name="SearchBox" Width="150" Margin="0,0,8,0"
                             Style="{DynamicResource SearchBoxStyle}"
                             Text="{Binding SearchText, RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Foreground="{DynamicResource TextSecondaryBrush}"
                             GotFocus="SearchBox_GotFocus"
                             LostFocus="SearchBox_LostFocus"
                             TextChanged="SearchBox_TextChanged"/>

                    <!-- Browse Peer Library Button -->
                    <Button Click="BrowsePeerButton_Click"
                            Padding="12,8" Cursor="Hand"
                            Background="#1A58A6FF" BorderThickness="1" BorderBrush="#58A6FF">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        CornerRadius="6" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#3358A6FF"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸŒ" FontSize="12" FontFamily="Segoe UI Emoji" Foreground="#58A6FF" Margin="0,0,6,0"/>
                            <TextBlock Text="Browse Peer Library" FontSize="12" Foreground="#58A6FF"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

            </Grid>
        </Grid>
    </Border>
</UserControl>
