<UserControl x:Class="SteamRoll.Controls.PlaytimeStatsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">

    <Grid Background="{DynamicResource BackgroundDarkBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with Back Button -->
        <Border Background="{DynamicResource BackgroundMediumBrush}" Padding="24,16">
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="BackBtn" Click="BackBtn_Click" 
                            Style="{DynamicResource SecondaryButton}" Margin="0,0,16,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â†" FontSize="14" Margin="0,0,6,0"/>
                            <TextBlock Text="Back"/>
                        </StackPanel>
                    </Button>
                    <!-- Stats Icon -->
                    <Viewbox Width="22" Height="22" Margin="0,0,12,0">
                        <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M19,3H5C3.9,3 3,3.9 3,5V19C3,20.1 3.9,21 5,21H19C20.1,21 21,20.1 21,19V5C21,3.9 20.1,3 19,3M9,17H7V10H9V17M13,17H11V7H13V17M17,17H15V13H17V17Z"/>
                        </Canvas>
                    </Viewbox>
                    <TextBlock Text="Playtime Statistics" FontSize="20" FontWeight="SemiBold" 
                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="24">
            <StackPanel MaxWidth="1000" HorizontalAlignment="Center">
                
                <!-- Summary Stats Cards -->
                <Border Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="12" Padding="24" Margin="0,0,0,24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                            <TextBlock x:Name="TotalPlaytimeText" Text="0h" FontSize="36" 
                                       FontWeight="Bold" Foreground="#58A6FF" HorizontalAlignment="Center"/>
                            <TextBlock Text="Total Playtime" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" 
                                       HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                            <TextBlock x:Name="GamesPlayedText" Text="0" FontSize="36" 
                                       FontWeight="Bold" Foreground="#3FB950" HorizontalAlignment="Center"/>
                            <TextBlock Text="Games Played" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" 
                                       HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                            <TextBlock x:Name="TotalSessionsText" Text="0" FontSize="36" 
                                       FontWeight="Bold" Foreground="#A371F7" HorizontalAlignment="Center"/>
                            <TextBlock Text="Total Sessions" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" 
                                       HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                            <TextBlock x:Name="AvgSessionText" Text="0m" FontSize="36" 
                                       FontWeight="Bold" Foreground="#F0883E" HorizontalAlignment="Center"/>
                            <TextBlock Text="Avg Session" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" 
                                       HorizontalAlignment="Center" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Two Column Layout -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Top Games Section -->
                    <Border Grid.Column="0" Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="12" Padding="20">
                        <StackPanel>
                            <TextBlock Text="ðŸ† Top Games by Playtime" FontSize="14" FontWeight="SemiBold" 
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,16"/>

                            <ItemsControl x:Name="TopGamesList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#21262D" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Width="28" Height="28" CornerRadius="14" 
                                                        Background="#30363D" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Rank}" FontSize="12" FontWeight="Bold"
                                                               Foreground="#58A6FF" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>

                                                <StackPanel Grid.Column="1" Margin="12,0">
                                                    <TextBlock Text="{Binding GameName}" FontSize="12" FontWeight="SemiBold"
                                                               Foreground="{DynamicResource TextPrimaryBrush}" 
                                                               TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Text="{Binding LastPlayedDisplay}" FontSize="10" 
                                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                </StackPanel>

                                                <TextBlock Grid.Column="2" Text="{Binding TotalPlaytimeDisplay}" 
                                                           FontSize="13" FontWeight="SemiBold" Foreground="#3FB950"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Recent Sessions Section -->
                    <Border Grid.Column="2" Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="12" Padding="20">
                        <StackPanel>
                            <TextBlock Text="ðŸ“… Recent Sessions" FontSize="14" FontWeight="SemiBold" 
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,16"/>

                            <ItemsControl x:Name="RecentSessionsList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#21262D" CornerRadius="8" Padding="12" Margin="0,0,0,6">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Text="{Binding GameName}" FontSize="12" 
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Grid.Column="1" Text="{Binding DateDisplay}" FontSize="10" 
                                                           Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,12,0"
                                                           VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{Binding DurationDisplay}" FontSize="12" 
                                                           Foreground="#58A6FF" FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Recently Played Games Widget -->
                <Border Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="12" Padding="20" Margin="0,24,0,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ•¹ï¸ Recently Played" FontSize="14" FontWeight="SemiBold" 
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                        
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                            <ItemsControl x:Name="RecentGamesList">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#21262D" CornerRadius="8" Width="160" Margin="0,0,12,0"
                                                Cursor="Hand" MouseLeftButtonUp="RecentGame_Click" Tag="{Binding}">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#30363D"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="75"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                
                                                <Border CornerRadius="8,8,0,0" Background="#0D1117">
                                                    <Image Source="{Binding HeaderImageUrl}" Stretch="UniformToFill"/>
                                                </Border>
                                                
                                                <StackPanel Grid.Row="1" Margin="10,8">
                                                    <TextBlock Text="{Binding GameName}" FontSize="11" FontWeight="SemiBold"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                                               TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,2,0,0">
                                                        <Run Text="â±ï¸"/>
                                                        <Run Text="{Binding TotalPlaytimeDisplay}"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
