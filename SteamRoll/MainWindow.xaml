<Window x:Class="SteamRoll.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:controls="clr-namespace:SteamRoll.Controls"
        mc:Ignorable="d"
        Title="SteamRoll - LAN Game Sharing" 
        Height="800" Width="1400"
        MinHeight="650" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        RenderOptions.BitmapScalingMode="HighQuality">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="8" CornerRadius="0" GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>
    
    <!-- Window Resources: Extracted styles to avoid BAML loading issues in single-file publish -->
    <Window.Resources>
        <!-- Value Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <controls:BooleanToHeartConverter x:Key="BooleanToHeartConverter"/>

        <!-- Header Image Border Style with hover opacity -->
        <Style x:Key="HeaderImageBorderStyle" TargetType="Border">
            <Setter Property="Opacity" Value="0.85"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Favorite Toggle Style -->
        <Style x:Key="FavoriteToggleStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                 <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Selection Checkbox Style -->
        <Style x:Key="SelectionCheckboxStyle" TargetType="CheckBox">
            <Setter Property="Opacity" Value="0.6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Opacity" Value="1"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="1"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Compatibility Dot Style -->
        <Style x:Key="CompatDotStyle" TargetType="Ellipse">
            <Setter Property="Fill" Value="#6E7681"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPackageable}" Value="True">
                    <Setter Property="Fill" Value="#3FB950"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding PrimaryDrm}" Value="Denuvo">
                    <Setter Property="Fill" Value="#F85149"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- DRM Type TextBlock Style -->
        <Style x:Key="DrmTypeTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource TextMutedBrush}"/>
            <Setter Property="Text" Value="{Binding PrimaryDrm}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding PrimaryDrm}" Value="SteamStub">
                    <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding PrimaryDrm}" Value="Denuvo">
                    <Setter Property="Foreground" Value="{DynamicResource ErrorBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- DLC Badge Border Style -->
        <Style x:Key="DlcBadgeBorderStyle" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#3A2A5C" Offset="0"/>
                        <GradientStop Color="#4A2A4C" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding HasDlc}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Packaged Badge Border Style -->
        <Style x:Key="PackagedBadgeBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="#1A3A2E"/>
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPackaged}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding IsReceivedPackage}" Value="True">
                    <Setter Property="Background" Value="#1A2A3A"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Packaged Icon TextBlock Style -->
        <Style x:Key="PackagedIconTextStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="âœ“"/>
            <Setter Property="Foreground" Value="#3FB950"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsReceivedPackage}" Value="True">
                    <Setter Property="Text" Value="ðŸ“¥"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Packaged Label TextBlock Style -->
        <Style x:Key="PackagedLabelTextStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="Packaged"/>
            <Setter Property="Foreground" Value="#3FB950"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsReceivedPackage}" Value="True">
                    <Setter Property="Text" Value="Received"/>
                    <Setter Property="Foreground" Value="#58A6FF"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Update Badge Border Style -->
        <Style x:Key="UpdateBadgeBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="#3E2C1A"/>
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding UpdateAvailable}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Ready Badge Border Style -->
        <Style x:Key="ReadyBadgeBorderStyle" TargetType="Border">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Setter Property="Background" Value="#1A3326"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPackageable}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Package Button Style -->
        <Style x:Key="PackageButtonStyle" TargetType="Button">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#238636" Offset="0"/>
                        <GradientStop Color="#2EA043" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <!-- Open Package mode: teal/cyan color -->
                <DataTrigger Binding="{Binding IsPackaged}" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#0D9488" Offset="0"/>
                                <GradientStop Color="#14B8A6" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Button Icon TextBlock Style -->
        <Style x:Key="ButtonIconTextStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="ðŸ“¦ "/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPackaged}" Value="True">
                    <Setter Property="Text" Value="ðŸ“‚ "/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Button Label TextBlock Style -->
        <Style x:Key="ButtonLabelTextStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="Create Package"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPackaged}" Value="True">
                    <Setter Property="Text" Value="Open"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Skeleton Card Style -->
        <Style x:Key="SkeletonCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#21262D"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Height" Value="240"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#30363D"/>
            <Setter Property="Opacity" Value="0.5"/>
        </Style>
    </Window.Resources>

    <!-- Window Container with custom chrome -->
    <Border Background="{DynamicResource BackgroundDarkBrush}" CornerRadius="8" BorderBrush="#3F3F46" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="36"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="#18181B" CornerRadius="8,8,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                        <TextBlock Text="ðŸŽ®" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="SteamRoll - LAN Game Sharing" Foreground="#A1A1AA" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,4,0">
                        <!-- Minimize Button -->
                        <Button x:Name="MinimizeButton" Content="â”€" Click="MinimizeButton_Click"
                                Style="{StaticResource WindowCaptionButtonStyle}"/>
                        <!-- Maximize Button -->
                        <Button x:Name="MaximizeButton" Content="â˜" Click="MaximizeButton_Click"
                                Style="{StaticResource WindowCaptionButtonStyle}"/>
                        <!-- Close Button -->
                        <Button x:Name="CloseButtonTitle" Content="âœ•" Click="CloseButton_Click"
                                Style="{StaticResource WindowCloseButtonStyle}"/>
                    </StackPanel>
                </Grid>
            </Border>
        
            <!-- Header -->
            <controls:WindowHeader x:Name="HeaderControl" Grid.Row="1"
                                   LibraryClicked="LibraryTab_Click"
                                   PackagesClicked="PackagesTab_Click"
                                   RefreshClicked="RefreshButton_Click"
                                   OpenOutputClicked="OpenOutputButton_Click"
                                   ImportPackageClicked="ImportPackageButton_Click"
                                   SettingsClicked="SettingsButton_Click"
                                   TransfersClicked="TransfersButton_Click"
                                   BrowsePeerClicked="BrowsePeerButton_Click"
                                   ViewModeToggleClicked="ViewModeToggle_Click"
                                   SelectModeToggleClicked="SelectModeToggle_Click"
                                   SearchTextChanged="SearchBox_TextChanged"/>
        
        <!-- Stats Bar -->
        <controls:StatsBar x:Name="StatsBarControl" Grid.Row="2"
                           FilterFavoritesClicked="FilterFavorites_Click"
                           FilterReadyClicked="FilterReady_Click"
                           FilterPackagedClicked="FilterPackaged_Click"
                           FilterDlcClicked="FilterDlc_Click"
                           FilterUpdateClicked="FilterUpdate_Click"
                           SortBoxSelectionChanged="SortBox_SelectionChanged"/>
        
        <!-- Library View Container (game list) -->
        <controls:GameLibraryView x:Name="GameLibraryViewControl" Grid.Row="3"
                                  RefreshClicked="RefreshButton_Click"
                                  GameCardClicked="GameCard_Click"
                                  FavoriteToggled="FavoriteToggle_Click"
                                  GameSelectionClicked="GameSelection_Click"
                                  PackageGameClicked="PackageButton_Click"
                                  SendGameToPeerClicked="SendToPeerButton_Click"
                                  BatchPackageClicked="BatchPackage_Click"
                                  BatchClearClicked="BatchClear_Click"
                                  BatchSendToPeerClicked="BatchSendToPeer_Click"
                                  ContextMenuFavoriteClicked="ContextMenu_Favorite_Click"
                                  ContextMenuBackupSaveClicked="ContextMenu_BackupSave_Click"
                                  ContextMenuCreatePackageClicked="ContextMenu_Package_Click"
                                  ContextMenuDeletePackageClicked="ContextMenu_DeletePackage_Click"
                                  ContextMenuSyncSavesClicked="ContextMenu_SyncSaves_Click"
                                  ContextMenuAdvancedConfigClicked="ContextMenu_AdvancedConfig_Click"
                                  ContextMenuOpenInstallFolderClicked="ContextMenu_OpenInstallFolder_Click"
                                  ContextMenuViewDetailsClicked="ContextMenu_ViewDetails_Click"
                                  ContextMenuVerifyIntegrityClicked="ContextMenu_VerifyIntegrity_Click"
                                  ContextMenuRepairFromPeerClicked="ContextMenu_RepairFromPeer_Click"
                                  ContextMenuOpenSteamStoreClicked="ContextMenu_OpenSteamStore_Click"
                                  ContextMenuUpdatePackageClicked="ContextMenu_UpdatePackage_Click"
                                  UpdatePackageClicked="ContextMenu_UpdatePackage_Click"
                                  InstallFromPeerClicked="InstallFromPeer_Click"/>
        


        
        <!-- Game Details View (hidden by default) -->
        <controls:GameDetailsView x:Name="GameDetailsView" Grid.Row="3" 
                                   Visibility="Collapsed"/>

        <!-- Transfers View (hidden by default) -->
        <controls:TransfersView x:Name="TransfersViewControl" Grid.Row="3" 
                                Visibility="Collapsed"
                                BackClicked="TransfersView_BackClicked"/>

        

        
        <!-- Status Bar -->
        <Border Grid.Row="4" Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="0,0,8,8" 
                BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="0,1,0,0" Padding="32,14">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="StatusText" Grid.Column="0" 
                           Text="Ready â€” Select a game to view details or create a package"
                           FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Goldberg Emulator + DLC Unlock" FontSize="11" 
                               Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,16,0"/>
                    <TextBlock Text="v1.1.0" FontSize="12" 
                               Foreground="{DynamicResource AccentPrimaryBrush}" FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Global Loading Overlay -->
        <controls:LoadingOverlay x:Name="LoadingOverlay" Grid.RowSpan="5"/>
        
        <!-- Toast Notification Container -->
        <StackPanel x:Name="ToastContainer" Grid.RowSpan="5"
                    HorizontalAlignment="Right" VerticalAlignment="Bottom"
                    Margin="0,0,16,80"/>
        </Grid>
    </Border>
</Window>

